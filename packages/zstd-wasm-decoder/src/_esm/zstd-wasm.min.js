function t(t,i){if(1===t.length)return t[0];const s=new Uint8Array(i);for(let i=0,r=0;t.length>i;++i){const h=t[i];s.set(h,r),r+=h.length}return s}var i,s=(new Map,new Map,new Map,9830464),r=2097152,h={buf:new Uint8Array(0),code:0,in_offset:0};class e{t;i;h;o;m;u;l=0;_=0;S=0;p=0;A=0;P=s;constructor(t={}){this.u={dictionary:t.dictionary,maxSrcSize:t.maxSrcSize||0,maxDstSize:t.maxDstSize||0}}init(t){return this.t=new WebAssembly.Instance(t,{env:{}}),this.M()}U(t,i){return this.t=t,this.M()}M(){if(this.i=this.t.exports,this.h=this.t.exports.memory,this.o=new Uint8Array(this.h.buffer),this.m=new Uint32Array(this.h.buffer),this.l=this.$(24),this._=this.l+12,this.i.createDCtx(),this.u.dictionary){const t=this.u.dictionary.length;if(t>4194304)throw Error("dict>2mb max size");const i=this.$(t);this.o.set(this.u.dictionary,i),this.S=this.i.createDict(i,t)}return this.p=this.$(r),this.A=this.p+r,this}$(t){return this.i.bmalloc(t)}decompressSync(t,i){if(!this.i)throw Error("module not initialized");const h=t.length;if(h>this.u.maxSrcSize)throw Error(`comp data ${h}b>maxSrcSize lim ${this.u.maxSrcSize}b)`);if(i||(i=(t=>{const i=t[4],s=i>>5&1,r=3&i,h=i>>6;return((t,i,s)=>{let r=0,h=0;for(;s>r;++r)h|=t[i++]<<(r<<3);return h})(t,6-s+r==3?4:r,h?1<<h:s)+(1==h&&256)})(t)),!i||i>s||h>r)return this.decompressStream(t,!0).buf;this.o.set(t,this.p),this.i.prune_buf(this.A);const e=this.A,n=this.i.decompressSync(e,this.P,this.p,h,this.S);if(0>n)throw Error("decomp failed err "+n);return this.o.slice(e,e+n)}D(t,i,s){const r=t>>>2;this.m[r]=i,this.m[r+1]=s,this.m[r+2]=0}W(t){return this.m[t+8>>>2]}decompressStream(i,s=!1){if(!this.i)throw Error("WASM module not initialized");s&&(this.i.reset(),this.S&&this.i.refDict(this.S),this.i.prune_buf(this.A));let r=h;if(!i||0===i.length)return r;const e=[];let n=0,o=0;const c=this.p+262150;let a=c,m=c+655360,u=0;for(;i.length>o;){const t=Math.min(Math.min(i.length-o,131075),262150);for(this.o.set(i.subarray(o,o+t),this.p),this.D(this.l,this.p,t),a==c&&this.D(this._,a,917501);this.W(this.l)<t;){const t=this.i.decStream(this._,this.l);if(0>t)throw Error("decomp err "+t);const i=this.W(this._);if(n+=a==c?i:i-u,u=i,i>0&&(a=c+i,m>a||(e.push(this.o.slice(c,a)),a=c,this.D(this._,a,917501)),n>this.u.maxDstSize))throw Error(`decomp size ${n}b>maxDstSize lim ${this.u.maxDstSize}b`)}o+=t}return a!=c&&e.push(this.o.slice(c,a)),r={buf:t(e,n),code:0,in_offset:i.length},r}destroy(){this.S=this.p=this.A=this.l=this._=this.t=this.i=this.h=this.o=this.m=null}}i=e;export{i as default,e as ZstdDecoder};