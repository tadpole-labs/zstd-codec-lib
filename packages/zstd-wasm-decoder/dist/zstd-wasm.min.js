var t=4194304,i=t/8;class s{t;i;h;o;u;m;_;l;S;p;A;D;M=!1;U=0;W=0;constructor(t={}){this.m={dictionary:t.dictionary,maxSrcSize:t.maxSrcSize||0,maxDstSize:t.maxDstSize||0}}async init(t){const s=await WebAssembly.instantiate(t,{env:{}});if(this.t=s,this.i=s.exports,this.h=s.exports.memory,this.o=new Uint8Array(this.h.buffer),this.u=new DataView(this.h.buffer),this.m.dictionary){if(this.m.dictionary.length>i/4)throw Error("Dictionary exceeds 2MB maximum size");this.l=this.createDDict(this.m.dictionary)}return this._=this.i._ZSTD_createDCtx(),this.A=this.$(16),this.D=this.$(16),this.P(!1),this}$(t){if(!this.i)throw Error("WASM module not initialized");return this.i.wasm_malloc(t)}P(s){const r=s?1:2;this.U=i*r,this.W=t/2*r,this.p=this.$(this.W),this.S=this.$(this.U),this.M=s}decompressSync(s,r){if(!this.i)throw Error("WASM module not initialized");const h=s.length;if(h>this.m.maxSrcSize)throw Error(`Compressed data (${h} bytes) exceeds maxSrcSize limit (${this.m.maxSrcSize} bytes)`);if(!r||r>t)return this.decompressStream(s,!0).buf;!this.M&&h>i&&this.P(!0),this.o.set(s,this.S);const e=this.i._ZSTD_decompress_usingDDict(this._,this.p,this.W,this.S,h,this.l||0);if(this.v(e))throw Error(`Decompression failed (error code: ${e})`);return this.o.slice(this.p,this.p+e)}B(t,i,s){this.u.setUint32(t,i,!0),this.u.setUint32(t+4,s,!0),this.u.setUint32(t+8,0,!0)}v(t){if(!this.i)throw Error("WASM module not initialized");return 0!==this.i._ZSTD_isError(t)}decompressStream(t,i=!1){if(!this.i)throw Error("WASM module not initialized");if(i&&(this.i._ZSTD_DCtx_reset(this._,1),this.l&&this.i._ZSTD_DCtx_refDDict(this._,this.l)),!t||0===t.length)return{buf:new Uint8Array(0),code:0,input_offset:0};const s=[];let r=0,h=0;for(;r<t.length;){const i=Math.min(t.length-r,131075);for(this.o.set(t.subarray(r,r+i),this.S),this.B(this.A,this.S,i);this.C(this.A+8)<i;){this.B(this.D,this.p,131072);const t=this.i._ZSTD_decompressStream(this._,this.D,this.A);if(this.v(t))throw Error(`Decompression error (error code: ${t})`);const i=this.C(this.D+8);if(i>0){if(h+=i,h>this.m.maxDstSize)throw Error(`Decompressed size (${h} bytes) exceeds maxDstSize limit (${this.m.maxDstSize} bytes)`);s.push(this.o.slice(this.p,this.p+i))}}r+=i}return{buf:s.length>0?"undefined"!=typeof Buffer?Buffer.concat(s):this.G(s):new Uint8Array(0),code:0,input_offset:t.length}}C(t){return this.u.getUint32(t,!0)}G(t){const i=new Uint8Array(t.reduce((t,i)=>t+i.length,0));let s=0;for(const r of t)i.set(r,s),s+=r.length;return i}freeDCtx(t){if(!this.i)throw Error("WASM module not initialized");return this.i._ZSTD_freeDCtx(t)}createDDict(t){const i=this.$(t.length);return this.o.set(t,i),this.i._ZSTD_createDDict(i,t.length)}freeDDict(t){if(!this.i)throw Error("WASM module not initialized");return this.i._ZSTD_freeDDict(t)}}var r=s;export{r as default,s as ZstdDecoder};